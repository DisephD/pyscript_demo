<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
	<!-- <script defer src="https://pyscript.net/alpha/pyscript.js"></script> -->
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>

    <!-- My CSS -->
	<link rel="stylesheet" href="index4style.css">

	<!--link to pyscript css and js-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

	<!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>


    <!--the code did not work until i used the latest version of pyscript js and used the pyconfig tag it threw a module not found error for pandas when i used pyenv since it is deprecated. also i do not like the new css version so i am still using alpha. also try to do everything in one file as the pychange is linked to only one file -->

    <title>Water Dashboard with PyScript</title>


    <py-config>
        packages = ['pandas','numpy','plotly']
    </py-config>
<!-- 
    <py-env>
- plotly
- pandas
- numpy       
    </py-env> -->

</head>

<body>
    
    <!--SIDEBAR -->
    <section class="sidebar" id="sidebar">
        <a href="#" class="brand">
            <span class="material-symbols-outlined">
                water_bottle
            </span>
            <span class="text">Water  Intake</span>
        </a>
        <ul class="side-menu top">
            <li class="active">
                <a href="#">
                    <i class='bx bxs-dashboard' ></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="index2.html">
                    <i class='bx bxs-doughnut-chart' ></i>
                    <span class="text">Analytics</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <i class='bx bxs-group' ></i>
                    <span class="text">Profile</span>
                </a>
            </li>
        </ul>
        <ul class="side-menu">
            <li>
                <a href="#" class="logout">
                    <i class='bx bxs-log-out-circle' ></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>

    <!--CENTER TOP-->
    <section class="dashboard">
        <!-- HEADER -->
        <div class="title">
            <h1>Dashboard</h1>

        <div class="filters">
            <label for="filter">Filter by</label>
            <select class="filter" id ="selected_month" py-change="selectChange()">
                <option value="">...</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
            </select>
        </div>
        </div>

        <p id="stats"></p>
        <div class = "center-top">
         <!--KPI section -->
            <div id="kpis" class = "kpis">
       
                <ul class="box-info">
                    <li>
                        <span class="material-symbols-outlined">
                            water_drop
                        </span>
                        <span class="text">
                            <p>Total ML</p>
                            <h3 id="total_water"></h3>
                        </span>
                    </li>
                    <li>
                        <span class="material-symbols-outlined">
                            water_full
                        </span>
                        <span class="text">
                            <p>Max ML</p>
                            <h3 id="highest_water"></h3>
                        </span>
                    </li>
                    <li>
                        <span class="material-symbols-outlined">
                            water_medium
                        </span>
                        <span class="text">
                            <p>Avg ML </p>
                            <h3 id="avg_water"></h3>
                        </span>
                    </li>
                    <li>
                        <span class="material-symbols-outlined">
                            water_medium
                        </span>
                        <span class="text">
                            <p>Target ML </p>
                            <h3 id="target_reach"></h3>
                        </span>
                    </li>
                <ul>

            </div>

            <!-- LINE SECTION -->
            <div id="line_graph" class="line_graph">
                <div id="line_chart">
                </div>

            </div>

            
        </div>

        
    <!--CENTER BOTTOM SECTION -->
        <div class="center-bottom">
        
            <!--TABLE-->
            <div id="table_graph" class="table_graph">
                <div id="table">
                </div>
            </div>
            
            
            <!-- HEATMAP -->
            <div id="heatchart" class="heatchart">
                <div id="heatmap">
                </div>
            </div>


            <!-- BAR CHART -->
            <div id="bar_graph" class="bar_graph">
                <div id="bar_chart">
                </div>
            </div>

    </section>
   
        

    <!-- <py-script output="kpis" src="./scripts/getstats.py">
	</py-script> -->

    <py-script output="line_chart" src="./scripts/app.py">
	</py-script>

<!-- 
	<py-script output="table" src="./scripts/table.py"> 
	</py-script>

	<py-script output="bar_chart" src="./scripts/bar.py">
	</py-script>
    
    <py-script output="heatmap" src="./scripts/heatmap.py">
	</py-script>  -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
	
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.js"></script>
	
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
	integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
	<!-- MDB -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.js"></script>


	<script>
		function waitForElm(selector) {
			return new Promise(resolve => {
				if (document.querySelector(selector)) {
					return resolve(document.querySelector(selector));
				}

				const observer = new MutationObserver(() => {
					if (document.querySelector(selector)) {
						resolve(document.querySelector(selector));
						observer.disconnect();
					}
				});

				observer.observe(document.body, {
					childList: true,
					subtree: true
				});
			});
		}

     
       // Function to fetch and update the stats element
        function updateStats() {
            // Fetch the stats data and update the stats element
            waitForElm('p#stats div').then(elm=> {   
                let stats = JSON.parse(elm.textContent);
                elm.style.display = "none";
                $(document).ready(function(){
                    $('#total_water').text(stats[0]);
                    $('#avg_water').text(stats[1]);
                    $('#highest_water').text(stats[2]);
                    $('#target_reach').text(stats[3]);
                });
        });

    // Hide the stats element
        document.getElementById('stats').style.display = 'none';
        }

        // Call the function to update the stats element when the page loads
        window.onload = function() {
            updateStats();
        };

        // Event listener for the dropdown select element
        document.getElementById('selected_month').addEventListener('change', function() {
            // Call the function to update the stats element when the dropdown value changes
            updateStats();
        });


	</script>


    <!-- <script>
        // Function to clear the content of the target element
        function clearContent() {
            document.getElementById('stats').innerHTML = '';
        }

        // Event listener for the dropdown select element
        document.getElementById('selected_month').addEventListener('change', function() {
            clearContent(); // Call the clearContent function when the dropdown value changes
        });
    </script> -->
</body>

</html>


<!-- I noticed the linkage in the html file is secondary to that of the linkage in the json part of the python file -->